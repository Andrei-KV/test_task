# RAG Chatbot

Это FastAPI-приложение представляет собой чат-бота с дополненной генерацией ответов (RAG), предназначенного для ответов на вопросы на основе предоставленных документов.

## Особенности

-   **FastAPI**: Современный, быстрый веб-фреймворк для создания API.
-   **RAG Pipeline**: Использует передовые модели для понимания запросов и генерации точных ответов на основе документов.
-   **Docker**: Полностью контейнеризован для легкой установки и развертывания.
-   **WebSocket**: Обеспечивает связь в реальном времени между клиентом и сервером.

## Архитектура

Приложение состоит из следующих компонентов:

-   **FastAPI App**: Основное приложение, обрабатывающее HTTP-запросы и WebSocket-соединения.
-   **PostgreSQL**: Реляционная база данных для хранения метаданных документов и чанков.
-   **Qdrant**: Векторная база данных для хранения эмбеддингов документов и выполнения семантического поиска.
-   **Redis**: Хранилище ключ-значение, используемое для кэширования и управления сессиями.

## Установка и запуск

### Требования

-   Docker
-   Docker Compose

### 1. Клонируйте репозиторий

```bash
git clone <URL-репозитория>
cd <имя-репозитория>
```

### 2. Настройте переменные окружения

Создайте файл `.env` из примера:

```bash
cp .env.example .env
```

Откройте `.env` в текстовом редакторе и установите необходимые значения, такие как ключи API для LLM и пароль к базе данных.

### 3. Сборка и запуск контейнеров

Запустите все сервисы с помощью Docker Compose:

```bash
sudo docker compose up --build -d
```

Эта команда соберет образ для FastAPI-приложения, загрузит образы для баз данных и запустит все контейнеры в фоновом режиме.

### 4. Доступ к приложению

После запуска всех контейнеров приложение будет доступно по адресу `http://localhost:8000`.

## Локальная разработка (без Docker)

Если вы предпочитаете запускать приложение локально без Docker, следуйте этим шагам:

### Требования

-   Python 3.12+
-   Poetry
-   PostgreSQL, Qdrant, и Redis, запущенные локально или в Docker.

### 1. Установите зависимости

```bash
poetry install
```

### 2. Настройте `.env`

Убедитесь, что ваш файл `.env` указывает на правильные адреса для ваших локально запущенных баз данных (например, `localhost`).

### 3. Запустите приложение

```bash
poetry run uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## Управление данными

Для управления документами в базе данных можно использовать следующие скрипты. Команды следует выполнять, когда контейнеры запущены.

### Добавление новых документов

Скрипт `process_new_documents_test.py` сканирует определенную папку (например, на Google Drive) и обрабатывает новые документы, добавляя их в базу данных.

Чтобы запустить его, выполните:

```bash
sudo docker compose exec app python process_new_documents_test.py
```

### Удаление определенного документа

Вы можете удалить документ и все связанные с ним данные по его ID.

```bash
sudo docker compose exec app python delete_document.py <document_id>
```
Замените `<document_id>` на ID документа, который вы хотите удалить.

### Полная очистка баз данных

Скрипт `clear_databases.py` полностью удаляет все данные из таблиц PostgreSQL и коллекции Qdrant.

**Внимание:** Эта операция необратима.

```bash
sudo docker compose exec app python clear_databases.py
```
