<!DOCTYPE html>
<html>
<head>
    <title>RAG_BOT_DEMO</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div id="chat-container">
        <div id="header">
            <img src="static/logo/g10.png" alt="DEWIAR AI Logo" width="48" height="53">
            <h2>DEWIAR AI</h2>
        </div>
        <ul id='messages'>
            </ul>
        <form id="form" onsubmit="sendMessage(event)">
            <input type="text" id="messageText" autocomplete="off" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å" maxlength="500"/>
            <div id="char-counter">0/500</div>
            <button>‚Üí</button>
        </form>
    </div>
    <script>
        var client_id = Date.now();
        var ws = new WebSocket(`ws://localhost:8000/api/v1/ws/${client_id}`);

        ws.onopen = function(event) {
            var messages = document.getElementById('messages');
            var message = document.createElement('li');
            message.className = 'message bot-message';
            var content = document.createElement('div');
            content.className = 'message-content';
            content.innerHTML = "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –°–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ, —è –æ—Ç–≤–µ—á—É –Ω–∞ –í–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã! üöÄ";
            message.appendChild(content);
            messages.appendChild(message);
        };
        
        ws.onmessage = function(event) {
            var messages = document.getElementById('messages');
            var message = document.createElement('li');
            message.className = 'message bot-message';
            var content = document.createElement('div');
            content.className = 'message-content';

            try {
                // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON
                const data = JSON.parse(event.data);
                if (data.text) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –µ–≥–æ –∫–∞–∫ Markdown
                    content.innerHTML = marked.parse(data.text);
                }
            } catch (e) {
                // –ï—Å–ª–∏ –Ω–µ JSON, –≤—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
                content.innerHTML = event.data;
            }

            message.appendChild(content);
            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight; // Auto-scroll
        };

        function sendMessage(event) {
            event.preventDefault();
            var input = document.getElementById("messageText");
            if (input.value.trim() === "") {
                return;
            }

            var messages = document.getElementById('messages');
            var message = document.createElement('li');
            message.className = 'message user-message';
            var content = document.createElement('div');
            content.className = 'message-content';
            content.innerHTML = input.value;
            message.appendChild(content);
            messages.appendChild(message);
            
            ws.send(input.value);
            input.value = '';
            updateCharCounter();
            messages.scrollTop = messages.scrollHeight; // Auto-scroll
        }

        const messageText = document.getElementById('messageText');
        const charCounter = document.getElementById('char-counter');

        function updateCharCounter() {
            const currentLength = messageText.value.length;
            charCounter.textContent = `${currentLength}/500`;
        }

        messageText.addEventListener('input', updateCharCounter);
        updateCharCounter();
    </script>
</body>
</html>
