import re
from typing import List

class TextPreProcessor:
    """
    Класс для очистки и первичной коррекции текста после OCR.
    """

    # Паттерны для удаления штампов и повторяющегося мусора (обобщенные)
    NOISE_PATTERNS = [
        # Стандартные заголовки штампов ГОСТ
        r"(?i)Изм\.?\s*Кол\.?\s*уч\.?\s*Лист\s*№\s*док\.?\s*Подп\.?\s*Дата",
        r"(?i)Стадия\s*Лист\s*Листов",
        r"(?i)^Лист\s*\d+\s*$",  # Одиночный номер листа
        r"(?i)^Формат\s*[AА]\d\s*$",
        
        # Должности и подписи (обобщенно)
        r"(?i)(Разраб|Пров|Т\.контр|Н\.контр|Утв|ГИП|Гап)\.?\s*[А-Яа-яёЁ\s\.]+",
        
        # Юридические лица (ловит ООО, ЗАО и кавычки)
        r"(?i)(ООО|АО|ЗАО)\s*[\"«][^\"»]+[\"»]",
        
        # Технические надписи копирования
        r"(?i)Копировал\s*[А-Яа-яёЁ\s\.]+",
        
        # Изолированные даты в формате ДД.ММ.ГГ или ДД.ММ.ГГГГ
        r"^\s*\d{2}\.\d{2}\.\d{2,4}\s*$"
    ]

    @classmethod
    def clean_text(cls, text: str) -> str:
        if not text:
            return ""

        cleaned_text = text

        # 1. Удаление штампов (NOISE)
        for pattern in cls.NOISE_PATTERNS:
            # Игнорируем регистр (уже в паттерне (?i)), multiline для начала/конца строки
            cleaned_text = re.sub(pattern, "", cleaned_text, flags=re.MULTILINE)

        # 2. Удаление лишних пробелов, возникших после удаления
        cleaned_text = re.sub(r'\n{3,}', '\n\n', cleaned_text) # Оставляем параграфы
        
        return cleaned_text.strip()
